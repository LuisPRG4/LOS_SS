<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Los SS - Cuentas por Cobrar</title>

    <link rel="icon" type="image/png" href="fav/los ss.png">

    <link rel="manifest" href="manifest.json">

    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/ayuda.css" />
    <link rel="stylesheet" href="css/calendar.css" />
    <link rel="stylesheet" href="css/whatsapp.css" />
    <link rel="stylesheet" href="css/chatbot-ayuda.css" />

</head>
<body>
    <div id="toastContainer" class="toast-container"> </div>

    <header class="header-elegante">
        <div class="header-container">
            <img src="logo/LOS SS.png" alt="Logo" class="logo-libre" />
            <div class="texto-header">
                <h1 class="titulo-header">ğŸ’° Cuentas por Cobrar</h1>
                <p class="descripcion-header">Gestiona y monitorea todas las ventas a crÃ©dito pendientes de pago.</p>
            </div>
        </div>
    </header>

    <nav>
        <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
        <ul id="navMenu">
            <li><a href="index.html">ğŸ  Inicio</a></li>
            <li><a href="inventario.html">ğŸ§ƒ Inventario</a></li>
            <li><a href="mermas.html">ğŸ“‰ Mermas</a></li>
            <li><a href="ventas.html">ğŸ§¾ Ventas</a></li>
            <li><a href="clientes.html">ğŸ‘¥ Clientes</a></li>
            <li><a href="proveedores.html">ğŸšš Proveedores</a></li>
            <li class="active"><a href="cuentas-por-cobrar.html">ğŸ’¸ Cuentas por Cobrar</a></li>
            <li><a href="reportesGraficos.html">ğŸ“Š Reportes</a></li>
            <li><a href="finanzas.html">ğŸ’° Finanzas</a></li>
            <li><a href="novedades.html">ğŸ¶ Novedades</a></li>
            <li><a href="pedidos.html">ğŸ“¦ Pedidos</a></li>
        </ul>
    </nav>

    <main>

        <!-- Puedes colocarla aquÃ­, despuÃ©s de la navegaciÃ³n principal -->
        <section class="seccion-calendario">
            <h2 class="titulo-calendario">ğŸ“… Calendario de Vencimientos</h2>
            <div id="calendarioVencimientos"></div> <!-- AquÃ­ se dibujarÃ¡ el calendario -->
        </section>

        <section class="filtro-seccion">
            <h2>ğŸ” Filtros de BÃºsqueda</h2>
            <div class="filtros-container">

                <div class="form-group">
                    <label for="filtroCliente">Buscar por Cliente:</label>
                    <input list="clientesLista" id="filtroCliente" class="form-control" placeholder="Nombre del cliente" autocomplete="off">
                    <datalist id="clientesLista"></datalist>
                </div>

                <div class="form-group">
                    <label for="filtroEstado">Estado de Pago:</label>
                    <select id="filtroEstado" class="form-control">
                        <option value="">Todas las Pendientes</option>
                        <option value="Pendiente">Pendiente (Sin abonos)</option>
                        <option value="Pagado Parcial">Pagado Parcial</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtroFechaVencimiento">Vencimiento hasta:</label>
                    <input type="date" id="filtroFechaVencimiento" class="form-control">
                </div>

                <div class="form-group-buttons">
                    <button id="btnFiltrarCuentas" class="btn-primary">Aplicar Filtros</button>
                    <button id="btnLimpiarFiltros" class="btn-secondary">Limpiar Filtros</button>
                </div>
            </div>
        </section>

        <section class="kpi-box">
            <h2>ğŸ“ˆ Resumen de Cuentas</h2>
            <div class="kpis">
                <div class="kpi"><strong>Total CrÃ©dito Activo:</strong> $<span id="totalCredito">0.00</span></div>
                <div class="kpi"><strong>Monto Pendiente Total:</strong> $<span id="montoPendienteGlobal">0.00</span></div>
                <div class="kpi"><strong>Vencidas / PrÃ³ximas:</strong> <span id="ventasVencidasProximas">0 / 0</span></div>
            </div>
        </section>

        <section class="listado-seccion">
            <h2>ğŸ“œ Ventas a CrÃ©dito Pendientes</h2>
            <div id="listaCuentasPorCobrar" class="grid-layout">
                <p class="mensaje-lista">Cargando ventas a crÃ©dito...</p>
            </div>
        </section>


         <!-- Ayuda contextual para Cuentas por Cobrar -->
    <section id="ayuda">
    <div class="h2title">
        <h2>ğŸ’° MÃ³dulo Cuentas por Cobrar</h2>
    </div>
    <h3>ğŸ“ Â¿CÃ³mo usar este mÃ³dulo?</h3>
    <div class="parrafito">
        <p>
            AquÃ­ puedes gestionar todas las ventas a crÃ©dito pendientes de pago, registrar abonos parciales y monitorear el estado de cada cuenta.
            Esto te ayuda a mantener un control claro de tus ingresos y facilitar la cobranza con tus clientes.
        </p>
    </div>
    <ul>
        <li>ğŸ”¹ Usa los filtros para buscar ventas por cliente, estado de pago o fecha de vencimiento.</li>
        <li>ğŸ”¹ Selecciona una venta para registrar abonos y actualizar el monto pendiente.</li>
        <li>ğŸ”¹ Revisa el resumen para ver totales activos, pendientes y vencidos.</li>
        <li>ğŸ”¹ MantÃ©n actualizada la informaciÃ³n para facilitar la gestiÃ³n financiera de tu negocio.</li>
    </ul>
    <button id="cerrarAyuda">Cerrar Ayuda</button>
    </section>

        
   <!-- Mini menÃº lateral con botÃ³n de flechita -->
    <div id="miniMenuLateral" class="expandido">
        <button id="btnAyudaFlotante" class="miniBoton dorado" title="Ayuda">â”</button>
        <button id="btnChatbot" class="miniBoton dorado" title="Chatbot">ğŸ’¬</button>
        <button id="toggleMiniMenu" class="miniBoton dorado toggleArrow" title="Ocultar menÃº">â¡ï¸</button>
    </div>

    <div id="panelChatbot">
  <button class="cerrarBtn" id="cerrarChatbot">Ã—</button>
  <h3>Chatbot - Cuentas por Cobrar</h3>
  <div id="chatbotContenido">
    <button onclick="mostrarRespuesta('queEsCuentaPorCobrar')">Â¿QuÃ© es una cuenta por cobrar?</button>
    <button onclick="mostrarRespuesta('registrarAbono')">Â¿CÃ³mo registrar un abono a una cuenta?</button>
    <button onclick="mostrarRespuesta('filtrarCuentas')">Â¿CÃ³mo uso los filtros para buscar cuentas?</button>
    <button onclick="mostrarRespuesta('estadoPago')">Â¿QuÃ© significan los estados de pago?</button>
    <button onclick="mostrarRespuesta('fechaVencimiento')">Â¿Para quÃ© sirve la fecha de vencimiento?</button>
    <button onclick="mostrarRespuesta('abonoParcial')">Â¿Puedo hacer abonos parciales?</button>
    <button onclick="mostrarRespuesta('ventasVencidas')">Â¿CÃ³mo identificar ventas vencidas o prÃ³ximas?</button>
    <button onclick="mostrarRespuesta('editarCuentas')">Â¿Puedo editar o eliminar una cuenta por cobrar?</button>
    <button onclick="mostrarRespuesta('notificaciones')">Â¿CÃ³mo recibir notificaciones de cuentas vencidas?</button>
    <button onclick="mostrarRespuesta('exportarCuentas')">Â¿Puedo exportar el historial de cuentas por cobrar?</button>
  </div>
  <div id="respuestaChatbot" style="margin-top: 10px;"></div>
</div>


    </main>

    <div id="modalAbono" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ’° Registrar Abono</h2>
                <span class="close-button" id="cerrarModalAbono">&times;</span>
            </div>
            <div class="modal-body">
                <div id="detalleVentaModal" class="detalle-venta-modal mb-4">
                    </div>

                <div class="form-group">
                    <label for="montoAbono">Monto del Abono:</label>
                    <input type="number" id="montoAbono" class="form-control" step="0.01" min="0" required>
                </div>

                <div class="form-group">
                    <label>Abonos Previos:</label>
                    <div id="listaAbonosModal" class="lista-abonos-modal">
                        </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnRegistrarAbono" class="btn-primary">Confirmar Abono</button>
                <button type="button" onclick="cerrarModalAbono()" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/calendar.js"></script> <!-- Â¡NUEVA LÃNEA CLAVE! -->
    <script src="js/cuentas-por-cobrar.js"></script>
    <script src="js/nav-highlighter.js" defer></script>
    <script src="js/chatbot-ayuda.js" defer></script>

    <script>
        // FunciÃ³n para abrir/cerrar el menÃº mÃ³vil
        function toggleMenu() {
            document.getElementById("navMenu").classList.toggle("open");
        }

        // RedirecciÃ³n si la sesiÃ³n no estÃ¡ iniciada (se mantiene aquÃ­ para seguridad)
        if (sessionStorage.getItem("sesionIniciada") !== "true") {
            window.location.href = "login.html";
        }

        // ELIMINADO: FunciÃ³n para cerrar sesiÃ³n
        /*
        function cerrarSesion() {
            sessionStorage.removeItem("sesionIniciada");
            window.location.href = "login.html";
        }
        */
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado con Ã©xito. Alcance:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Fallo el registro del Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
